<ng-container *ngIf="vm$ | async as vm">
  <div class="dashboard-layout">
    <!-- Main Content -->
    <div class="dashboard-container">
      <div class="dashboard-header">
        <h1>Dashboard</h1>
        <button class="refresh-btn" (click)="refreshData()" [disabled]="vm.loading">
          <span [class.spinning]="vm.loading">üîÑ</span> Refresh
        </button>
      </div>

    <div *ngIf="vm.loading" class="loading">Loading dashboard data...</div>

    <div *ngIf="!vm.loading" class="dashboard-content">
    <!-- Stats Cards -->
    <div class="stats-grid">
      <a class="stat-card users" routerLink="/admin/users">
        <div class="stat-icon">üë•</div>
        <div class="stat-info">
          <h3>{{vm.stats.totalUsers}}</h3>
          <p>Total Users</p>
        </div>
      </a>

      <a class="stat-card products" routerLink="/admin/products">
        <div class="stat-icon">üëï</div>
        <div class="stat-info">
          <h3>{{vm.stats.totalProducts}}</h3>
          <p>Products</p>
        </div>
      </a>

      <a class="stat-card orders" routerLink="/admin/orders">
        <div class="stat-icon">üì¶</div>
        <div class="stat-info">
          <h3>{{vm.stats.totalOrders}}</h3>
          <p>Total Orders</p>
        </div>
      </a>

      <a class="stat-card revenue" routerLink="/admin/financials">
        <div class="stat-icon">üí∞</div>
        <div class="stat-info">
          <h3>${{vm.stats.totalRevenue | number:'1.2-2'}}</h3>
          <p>Revenue</p>
        </div>
      </a>

      <a class="stat-card inventory" routerLink="/admin/inventory">
        <div class="stat-icon">‚ö†Ô∏è</div>
        <div class="stat-info">
          <h3>{{vm.stats.lowStockItems}}</h3>
          <p>Low Stock Items</p>
        </div>
      </a>
    </div>

    <!-- Data Tables -->
    <div class="tables-grid">
      <!-- Recent Orders -->
      <div class="table-card">
        <h2>Recent Orders</h2>
        <div class="table-container">
          <table *ngIf="vm.recentOrders.length > 0; else noOrders">
            <thead>
              <tr>
                <th>Order ID</th>
                <th>Customer</th>
                <th>Amount</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let order of vm.recentOrders">
                <td>{{order._id?.slice(-6) || 'N/A'}}</td>
                <td>{{order.customerName || 'Unknown'}}</td>
                <td>${{order.total || 0 | number:'1.2-2'}}</td>
                <td><span class="status" [class]="order.status?.toLowerCase()">{{order.status || 'Pending'}}</span></td>
              </tr>
            </tbody>
          </table>
          <ng-template #noOrders>
            <p class="no-data">No recent orders</p>
          </ng-template>
        </div>
      </div>

      <!-- Top Products -->
      <div class="table-card">
        <h2>Products Overview</h2>
        <div class="table-container">
          <table *ngIf="vm.topProducts.length > 0; else noProducts">
            <thead>
              <tr>
                <th>Product</th>
                <th>Price</th>
                <th>Category</th>
                <th>Stock</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let product of vm.topProducts">
                <td>{{product.name || 'Unnamed Product'}}</td>
                <td>${{product.price || 0 | number:'1.2-2'}}</td>
                <td>{{product.category || 'Uncategorized'}}</td>
                <td><span [class.low-stock]="(product.stock || 0) < 10">{{product.stock || 0}}</span></td>
              </tr>
            </tbody>
          </table>
          <ng-template #noProducts>
            <p class="no-data">No products available</p>
          </ng-template>
        </div>
      </div>
    </div>
    </div>
    </div>
  </div>
</ng-container>
