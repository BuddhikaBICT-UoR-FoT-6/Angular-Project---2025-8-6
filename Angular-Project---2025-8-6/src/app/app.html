<nav class="main-nav">
  <div class="nav-container">
    <a routerLink="/" class="brand-link">
      <h1>Clothing Store</h1>
    </a>
    <div class="nav-links">
      <div class="nav-search" (focusin)="openSearch()" (keydown.escape)="closeSearch()">
        <input type="search" class="nav-search-input" placeholder="Search products..." aria-label="Search products"
          autocomplete="off" [formControl]="searchControl" />

        <div class="nav-search-dropdown" *ngIf="searchOpen">
          <ng-container *ngIf="searchResults$ | async as results">
            <div class="nav-search-hint" *ngIf="searchControl.value.trim().length < 2">
              Type at least 2 characters
            </div>

            <button type="button" class="nav-search-item" *ngFor="let p of results" (mousedown)="goToProduct(p._id)">
              <span class="name">{{ p.name }}</span>
              <span class="price">{{ p.price | currency }}</span>
            </button>

            <div class="nav-search-empty" *ngIf="searchControl.value.trim().length >= 2 && results.length === 0">
              No matches
            </div>
          </ng-container>
        </div>
      </div>

      <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">Showroom</a>

      <button type="button" class="theme-toggle" (click)="toggleTheme()"
        [attr.aria-label]="theme === 'dark' ? 'Switch to light mode' : 'Switch to dark mode'">
        <span *ngIf="theme === 'dark'">â˜€ï¸</span>
        <span *ngIf="theme === 'light'">ğŸŒ™</span>
      </button>

      <!-- Role-based dashboards -->
      <a *ngIf="isLoggedIn() && isAdmin()" class="nav-btn" routerLink="/admin/dashboard">Admin Dashboard</a>
      <a *ngIf="isLoggedIn() && isSuperAdmin()" class="nav-btn" routerLink="/superadmin/dashboard">Super Admin</a>
      <a *ngIf="isLoggedIn() && isCustomer()" class="nav-btn" routerLink="/customer/dashboard">My Dashboard</a>

      <div *ngIf="!isLoggedIn()" class="auth-links">
        <a routerLink="/login" routerLinkActive="active">Login</a>
        <a routerLink="/register" routerLinkActive="active">Register</a>
      </div>
      <div *ngIf="isLoggedIn()" class="user-menu">
        <span class="user-name">Welcome, {{getCurrentUser()?.full_name || getCurrentUser()?.email}}</span>
        <button (click)="logout()" class="logout-btn">Logout</button>
      </div>
    </div>
  </div>
</nav>

<!-- Global toast notifications (purple theme) -->
<app-toast></app-toast>

<!-- Admin/SuperAdmin Sidebar (shows on admin or superadmin routes) -->
<aside *ngIf="isAdminRoute()" class="admin-sidebar" [class.collapsed]="sidebarCollapsed"
  (mouseenter)="onSidebarMouseEnter()" (mouseleave)="onSidebarMouseLeave()">

  <!-- SuperAdmin Links -->
  <nav *ngIf="isSuperAdmin()" class="sidebar-nav">
    <a [routerLink]="getSidebarDashboardRoute()" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}"
      class="sidebar-link">
      <span class="link-icon">ğŸ </span>
      <span class="link-text">Dashboard</span>
    </a>
    <a routerLink="/admin/orders" routerLinkActive="active" class="sidebar-link">
      <span class="link-icon">ğŸ§¾</span>
      <span class="link-text">Orders</span>
    </a>
    <a routerLink="/admin/inventory" routerLinkActive="active" class="sidebar-link">
      <span class="link-icon">ğŸ“¦</span>
      <span class="link-text">Inventory</span>
    </a>
    <a routerLink="/admin/restock-requests" routerLinkActive="active" class="sidebar-link">
      <span class="link-icon">ğŸ”„</span>
      <span class="link-text">Restock Requests</span>
    </a>
    <a routerLink="/admin/categories" routerLinkActive="active" class="sidebar-link">
      <span class="link-icon">ğŸ·ï¸</span>
      <span class="link-text">Categories</span>
    </a>
    <a routerLink="/admin/collections" routerLinkActive="active" class="sidebar-link">
      <span class="link-icon">ğŸ›ï¸</span>
      <span class="link-text">Collections</span>
    </a>
    <a routerLink="/admin/products" routerLinkActive="active" class="sidebar-link">
      <span class="link-icon">ğŸ‘•</span>
      <span class="link-text">Products</span>
    </a>
    <a routerLink="/admin/users" routerLinkActive="active" class="sidebar-link">
      <span class="link-icon">ğŸ‘¥</span>
      <span class="link-text">Users</span>
    </a>
    <a routerLink="/admin/financials" routerLinkActive="active" class="sidebar-link">
      <span class="link-icon">ğŸ’°</span>
      <span class="link-text">Financials</span>
    </a>
    <a routerLink="/admin/reports" routerLinkActive="active" class="sidebar-link">
      <span class="link-icon">ğŸ“¤</span>
      <span class="link-text">Reports</span>
    </a>
    <a routerLink="/admin/analytics" routerLinkActive="active" class="sidebar-link">
      <span class="link-icon">ğŸ“ˆ</span>
      <span class="link-text">Analytics</span>
    </a>
    <a routerLink="/admin/admin-management" routerLinkActive="active" class="sidebar-link">
      <span class="link-icon">ğŸ›¡ï¸</span>
      <span class="link-text">Admin Management</span>
    </a>
  </nav>

  <!-- Regular Admin Links -->
  <nav *ngIf="isAdmin()" class="sidebar-nav">
    <a [routerLink]="getSidebarDashboardRoute()" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}"
      class="sidebar-link">
      <span class="link-icon">ğŸ </span>
      <span class="link-text">Dashboard</span>
    </a>
    <a routerLink="/admin/orders" routerLinkActive="active" class="sidebar-link">
      <span class="link-icon">ğŸ§¾</span>
      <span class="link-text">Orders</span>
    </a>
    <a routerLink="/admin/inventory" routerLinkActive="active" class="sidebar-link">
      <span class="link-icon">ğŸ“¦</span>
      <span class="link-text">Inventory</span>
    </a>
    <a routerLink="/admin/categories" routerLinkActive="active" class="sidebar-link">
      <span class="link-icon">ğŸ·ï¸</span>
      <span class="link-text">Categories</span>
    </a>
    <a routerLink="/admin/collections" routerLinkActive="active" class="sidebar-link">
      <span class="link-icon">ğŸ›ï¸</span>
      <span class="link-text">Collections</span>
    </a>
    <a routerLink="/admin/products" routerLinkActive="active" class="sidebar-link">
      <span class="link-icon">ğŸ‘•</span>
      <span class="link-text">Products</span>
    </a>
    <a routerLink="/admin/users" routerLinkActive="active" class="sidebar-link">
      <span class="link-icon">ğŸ‘¥</span>
      <span class="link-text">Users</span>
    </a>
    <a routerLink="/admin/financials" routerLinkActive="active" class="sidebar-link">
      <span class="link-icon">ğŸ’°</span>
      <span class="link-text">Financials</span>
    </a>
    <a routerLink="/admin/reports" routerLinkActive="active" class="sidebar-link">
      <span class="link-icon">ğŸ“¤</span>
      <span class="link-text">Reports</span>
    </a>
    <a routerLink="/admin/analytics" routerLinkActive="active" class="sidebar-link">
      <span class="link-icon">ğŸ“ˆ</span>
      <span class="link-text">Analytics</span>
    </a>
  </nav>
</aside>

<main class="main-content" [class.with-sidebar]="isAdminRoute()"
  [class.sidebar-expanded]="isAdminRoute() && !sidebarCollapsed">
  <div class="container">
    <router-outlet></router-outlet>
  </div>
</main>

<!-- Customer footer CTA (only when logged in as customer) -->
<footer *ngIf="isLoggedIn() && isCustomer() && !isShowroomRoute()" class="shop-footer">
  <div class="container footer-inner">
    <div>
      <div class="footer-title">Ready to start shopping?</div>
      <div class="footer-sub">Browse new arrivals and manage your cart.</div>
    </div>
    <a routerLink="/" class="shop-cta">Go to Showroom</a>
  </div>
</footer>